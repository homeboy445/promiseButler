!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.promiseButler=t():e.promiseButler=t()}(self,(()=>(()=>{"use strict";var e,t={d:(e,o)=>{for(var s in o)t.o(o,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};t.r(o),t.d(o,{getModeObject:()=>h}),function(e){e.SEQUENTIAL="SEQUENTIAL",e.BATCHED="BATCHED",e.PIPELINING="PIPELINING",e.PARALLEL="PARALLEL"}(e||(e={}));var s=function(e,t,o,s){return new(o||(o=Promise))((function(i,r){function n(e){try{h(s.next(e))}catch(e){r(e)}}function l(e){try{h(s.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,l)}h((s=s.apply(e,t||[])).next())}))};class i{constructor({batchSize:e,debugMode:t,batchWiseCallback:o}){this.requestsArr=[],this.globalPromiseStore={promise:Promise.resolve(),pending:!1},this.BATCH_SIZE=6,this.batchWiseCallback=(...e)=>{},this.promiseResolvedStore={resolve:e=>{}},this.debugMode=!1,this.debugMode=null!=t?t:this.debugMode,this.BATCH_SIZE=null!=e?e:this.BATCH_SIZE,this.batchWiseCallback=null!=o?o:this.batchWiseCallback,this.log("Input params are: ",arguments)}log(...e){this.debugMode&&console.log(...e)}processPromise(e,t){return s(this,void 0,void 0,(function*(){if(this.globalPromiseStore.pending)return yield this.globalPromiseStore.promise,this.processPromise(e,t);this.log("Adding the promise in the array! ",t),this.requestsArr.push(e().then((e=>{var o,s;this.promiseResolvedStore[t]=e,null===(s=null===(o=this.promiseResolvedStore)||void 0===o?void 0:o.resolve)||void 0===s||s.call(o,t)})).catch((e=>this.promiseResolvedStore[t]=e))),this.requestsArr.length==this.BATCH_SIZE&&(this.globalPromiseStore={promise:Promise.all(this.requestsArr).then((()=>{this.log("A batch got completed!"),this.batchWiseCallback(this.requestsArr),this.requestsArr=[],this.globalPromiseStore.pending=!1})),pending:!0})}))}dispatch(e){return s(this,void 0,void 0,(function*(){return this.globalPromiseStore.pending&&(yield this.globalPromiseStore.promise),new Promise((t=>{this.promiseResolvedStore.resolve=o=>{this.log("The promise at index",o," is complete!"),e.length-1==o&&(this.log("All of the promises are resolved!"),delete this.promiseResolvedStore.resolve,t(Object.values(this.promiseResolvedStore)))},e.forEach(this.processPromise.bind(this))}))}))}}var r=function(e,t,o,s){return new(o||(o=Promise))((function(i,r){function n(e){try{h(s.next(e))}catch(e){r(e)}}function l(e){try{h(s.throw(e))}catch(e){r(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,l)}h((s=s.apply(e,t||[])).next())}))};class n{constructor({debugMode:e,slotSize:t}){this.requestSlots={},this.SLOT_SIZE=6,this.requestCounter=0,this.globalPromiseStore={resolve:e=>{},reject:()=>{},resolvedPromises:{}},this.promiseRequestStore={},this.debugMode=!1,this.debugMode=null!=e?e:this.debugMode,this.SLOT_SIZE=null!=t?t:this.SLOT_SIZE}log(...e){this.debugMode&&console.log(...e)}executePromise(e,t){return r(this,void 0,void 0,(function*(){const{value:o,done:s}=e.next();if(s||!o)return Promise.resolve();const{promiseCallback:i,index:n}=o,l=`${t}.${++this.requestCounter}`;return this.promiseRequestStore[l]=!1,this.log("Assigning the promise callback at index: ",n,", to slot: ",t),this.requestSlots[t].then((()=>{const e=i();return this.log("Outcome of the promise of index: ",n," ",e),e})).catch((e=>(this.log("promise failed in slot: ",t),e))).then((o=>r(this,void 0,void 0,(function*(){this.log("promise at index: ",n," is complete!"),delete this.promiseRequestStore[l],this.globalPromiseStore.resolvedPromises[n]=o,yield this.executePromise(e,t),0===Object.keys(this.promiseRequestStore).length&&(this.globalPromiseStore.resolve(Object.values(this.globalPromiseStore.resolvedPromises)),this.promiseRequestStore={done:!0})}))))}))}dispatch(e){return r(this,void 0,void 0,(function*(){return new Promise(((t,o)=>{const s=function*(){for(let t=0;t<e.length;t++)yield{promiseCallback:e[t],index:t}}();this.globalPromiseStore={resolve:t,reject:o,resolvedPromises:{}};for(let e=0;e<this.SLOT_SIZE;e++)this.requestSlots[e]=Promise.resolve(),this.executePromise(s,e)}))}))}}class l{constructor({debugMode:e}){var t;this.requestPromise=Promise.resolve(),this.debugMode=!1,this.debugMode=null!==(t=this.debugMode)&&void 0!==t?t:e}log(...e){this.debugMode&&console.log(...e)}dispatch(e){const t={},o=this;return new Promise((s=>{e.forEach(((e,s)=>{o.requestPromise=o.requestPromise.then((()=>e().then((e=>{o.log("The promise of index: ",s," is successfull!"),t[s]=e})).catch((e=>{o.log("The promise of index: ",s," is failed!"),t[s]=e}))))})),o.requestPromise=this.requestPromise.then((()=>{o.log("The promise is complete!"),s(Object.values(t))}))}))}}const h=(t={debugMode:!1})=>({[e.SEQUENTIAL]:()=>{const e=new l(t);return e.dispatch.bind(e)},[e.BATCHED]:(e=6,o=((...e)=>{}))=>{const s=new i(Object.assign(Object.assign({},t),{batchSize:e,batchWiseCallback:o}));return s.dispatch.bind(s)},[e.PIPELINING]:(e=6)=>{const o=new n(Object.assign(Object.assign({},t),{slotSize:e}));return o.dispatch.bind(o)}});return o})()));